<mat-card>
  <mat-card-header>
    <mat-card-title>Cassettes Magnéto-Serge</mat-card-title>
    <mat-card-subtitle>
      <ng-container *ngIf="paginationInfo$ | async as pagination">
        Affichage {{ pagination.startIndex }} - {{ pagination.endIndex }} sur {{ pagination.totalItems }}
      </ng-container>
    </mat-card-subtitle>
    <button mat-icon-button (click)="reload()" [disabled]="(loading$ | async) ?? false">
      <mat-icon>refresh</mat-icon>
    </button>
  </mat-card-header>

  <mat-card-content>
    <!-- Loading Skeleton -->
    <div *ngIf="loading$ | async" class="loading-skeleton">
      <div class="skeleton-row" *ngFor="let item of [1,2,3,4,5]">
        <div class="skeleton-cell skeleton-name"></div>
        <div class="skeleton-cell skeleton-version"></div>
        <div class="skeleton-cell skeleton-date"></div>
        <div class="skeleton-cell skeleton-count"></div>
        <div class="skeleton-cell skeleton-size"></div>
        <div class="skeleton-cell skeleton-actions"></div>
      </div>
    </div>

    <!-- Error Message -->
    <div *ngIf="error$ | async as error" class="error-container">
      <mat-icon color="warn">error</mat-icon>
      <p>{{ error }}</p>
      <button mat-raised-button color="primary" (click)="reload()">
        Réessayer
      </button>
    </div>

    <!-- Table -->
    <div *ngIf="!(loading$ | async) && !(error$ | async)" class="table-container">
      <table mat-table [dataSource]="(cassettes$ | async) ?? []" class="cassette-table">

        <!-- Colonne Nom -->
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>Nom</th>
          <td mat-cell *matCellDef="let cassette">
            <strong>{{ cassette.name }}</strong>
          </td>
        </ng-container>

        <!-- Colonne Version -->
        <ng-container matColumnDef="version">
          <th mat-header-cell *matHeaderCellDef>Version</th>
          <td mat-cell *matCellDef="let cassette">{{ cassette.version }}</td>
        </ng-container>

        <!-- Colonne Date d'enregistrement -->
        <ng-container matColumnDef="recordedAt">
          <th mat-header-cell *matHeaderCellDef>Enregistrée le</th>
          <td mat-cell *matCellDef="let cassette">{{ formatDate(cassette.recordedAt) }}</td>
        </ng-container>

        <!-- Colonne Nombre d'interactions -->
        <ng-container matColumnDef="interactionCount">
          <th mat-header-cell *matHeaderCellDef>Interactions</th>
          <td mat-cell *matCellDef="let cassette" class="text-center">
            <mat-icon class="interaction-icon">sync_alt</mat-icon>
            {{ cassette.interactionCount }}
          </td>
        </ng-container>

        <!-- Colonne Taille -->
        <ng-container matColumnDef="sizeBytes">
          <th mat-header-cell *matHeaderCellDef>Taille</th>
          <td mat-cell *matCellDef="let cassette">{{ formatSize(cassette.sizeBytes) }}</td>
        </ng-container>

        <!-- Colonne Actions -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let cassette">
            <button
              mat-icon-button
              color="primary"
              (click)="viewDetails(cassette)"
              matTooltip="Voir les détails"
            >
              <mat-icon>visibility</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr
          mat-row
          *matRowDef="let row; columns: displayedColumns;"
          class="cassette-row"
        ></tr>

        <!-- No Data Row -->
        <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell" [attr.colspan]="displayedColumns.length">
            <div class="no-data">
              <mat-icon>inventory_2</mat-icon>
              <p>Aucune cassette disponible</p>
              <span class="empty-subtitle">Commencez par enregistrer une interaction avec Magnéto-Serge</span>
            </div>
          </td>
        </tr>
      </table>
    </div>

    <!-- Pagination Hydra -->
    <div *ngIf="!(loading$ | async) && (paginationInfo$ | async) as pagination" class="pagination-container">
      <div class="pagination-info">
        Page {{ pagination.page }} sur {{ pagination.totalPages }}
      </div>
      <div class="pagination-controls">
        <button
          mat-icon-button
          (click)="firstPage()"
          [disabled]="!pagination.hasPrevious"
          matTooltip="Première page"
        >
          <mat-icon>first_page</mat-icon>
        </button>
        <button
          mat-icon-button
          (click)="previousPage()"
          [disabled]="!pagination.hasPrevious"
          matTooltip="Page précédente"
        >
          <mat-icon>chevron_left</mat-icon>
        </button>
        <button
          mat-icon-button
          (click)="nextPage()"
          [disabled]="!pagination.hasNext"
          matTooltip="Page suivante"
        >
          <mat-icon>chevron_right</mat-icon>
        </button>
        <button
          mat-icon-button
          (click)="lastPage()"
          [disabled]="!pagination.hasNext"
          matTooltip="Dernière page"
        >
          <mat-icon>last_page</mat-icon>
        </button>
      </div>
    </div>
  </mat-card-content>
</mat-card>
